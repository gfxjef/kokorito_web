'use client'

import React, { useState } from 'react';
import { X, Send } from 'lucide-react';

const WhatsAppToggle: React.FC = () => {
  const [isOpen, setIsOpen] = useState(false);
  const [isClosing, setIsClosing] = useState(false);
  const [message, setMessage] = useState('');

  const handleClose = () => {
    setIsClosing(true);
    setTimeout(() => {
      setIsOpen(false);
      setIsClosing(false);
    }, 300);
  };

  const handleOpen = () => {
    setIsOpen(true);
  };

  const handleSendToWhatsApp = () => {
    const phoneNumber = "51938101013";
    const textToSend = message.trim() || "¡Hola! Estoy interesado en sus productos de Kokorito.";
    const encodedText = encodeURIComponent(textToSend);
    window.open(`https://wa.me/${phoneNumber}?text=${encodedText}`, '_blank');
    
    // Limpiar el input después de enviar
    setMessage('');
  };

  const handleKeyPress = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSendToWhatsApp();
    }
  };

  // Componente del logo de Kokorito (mismo del header)
  const KokoritoLogo = () => (
    <svg className="h-8 w-auto" viewBox="0 0 422.52 296.05" xmlns="http://www.w3.org/2000/svg">
      <path fill="white" d="M186.27,226.14s-5.22-4-9.61-8.08c-1.84-1.71-3.53-3.44-4.63-4.9-39,20.34-45.73,27.37-71.42,40.46-25.69,13.09-30.59,15.82-44.36,15.82-5.06,0-8.48-1.53-10.63-4.04-3.7-4.32-3.66-11.57-1.78-19.04,2.98-11.82,6.33-24.66,6.33-24.66l8.63-6.93s1.19,19.03,10.17,29.08c8.98,10.05,23.5,9.87,33.13,3.54,8.49-5.57,10.94-8.55,9.29-11.82-.22-.44-.52-.89-.89-1.35-2.21-2.72-6.75,1.4-7.72,1.88-4.47,2.84-11.82,2.21-16.92-1.84-5.1-4.05-6.75-12.1-10.89-24.9-1.58-5.03-4.23-7.31-4.23-7.31,0,0,16.89-16.38,25.92-30.76,9.03-14.38,11.4-25.27,11.4-33.37,0-6.18-2.3-16.01-8.08-23.09-1.8-2.2-3.93-4.14-6.44-5.61-.45-.27-.87-.49-1.26-.68-4.85-2.35-5,1.27-3.36,2.79,1.77,1.64,11.6,10.58,11.6,24.91,0,3.17-.45,6.33-1.31,9.48-3.03,11.09-11.15,22.09-22.61,33.15-12.08,11.66-17.66,16.35-19.26,17.65-.35.28-.51.41-.51.41,0,0,8.19-31.64,9.82-40.39.86-4.62.98-10.58-1.91-15.17-2.58-4.1-7.54-7.12-16.52-7.12-16.61,0-28.85,10.8-36.67,19.36-7.23,7.92-10.95,13.37-11.47,25.96-.04,1.03-.07,2.1-.07,3.22,0,14.94,10.64,20.13,15.61,20.13,6.27,0,14.4-3.85,14.4-14.64,0-3.76-.61-6.28-1.57-8.05-1.8-3.32-4.81-4.02-7.3-5.35,4.72-13.4,21.27-21.22,26.53-20.1-8,42.25-21.08,82-22.99,94.84-.74,4.97-1.33,9.99-1.33,14.84.01,7.7,1.54,15,6.45,21.08,8,9.91,20.8,15.78,48.91,3.86,22.38-10.01,44.61-28.57,73.95-45.65,25.63-14.92,33.63-17.61,33.63-17.61Z"/>
      <path fill="white" d="M139.78,166.92c-3.1-5.33-8.2-9.41-15.57-9.4-3.65,0-17.65,2.32-27.33,25.4-1.82,4.8-3.26,10.69-3.79,16.58-1.2,13.4,2.31,26.82,16.83,27.54,22.5,1.12,33.55-36.21,33.55-46.21,0-4.47-1.19-9.61-3.69-13.92ZM108.71,196.52c2.19-8.8,8.05-27.13,17.73-27.13,3.22,0,4.05,2.95,4.26,5.56.05.67.07,1.32.07,1.89-.88,21.31-14.05,37.42-20.24,37.42-.77,0-1.41-.14-1.94-.4-3.71-1.82-1.79-9.63.12-17.33Z"/>
      <path fill="white" d="M232.23,113.41c-3.65,0-17.65,2.32-27.33,25.4-1.82,4.8-3.26,10.69-3.79,16.58-1.2,13.4,2.31,26.82,16.83,27.54,22.5,1.12,33.55-36.21,33.55-46.21,0-4.47-1.19-9.61-3.69-13.92-3.1-5.33-8.2-9.41-15.57-9.4ZM216.74,152.41c2.19-8.8,8.05-27.13,17.73-27.13,3.22,0,4.05,2.94,4.26,5.56.05.67.07,1.32.07,1.89-.88,21.31-14.05,37.42-20.24,37.42-.77,0-1.41-.14-1.94-.4-3.71-1.82-1.79-9.63.12-17.33Z"/>
      <path fill="white" d="M358.78,95.21c-1.82,4.8-3.26,10.69-3.79,16.58-1.2,13.4,2.31,26.82,16.83,27.54,22.5,1.12,33.55-36.21,33.55-46.21,0-4.47-1.19-9.61-3.69-13.92-3.1-5.33-8.2-9.41-15.57-9.4-3.65,0-17.65,2.32-27.33,25.4ZM372.43,126.54c-.77,0-1.41-.14-1.94-.4-3.71-1.82-1.79-9.63.12-17.33,2.19-8.8,8.05-27.13,17.73-27.13,3.22,0,4.05,2.95,4.26,5.56.05.67.07,1.32.07,1.89-.88,21.31-14.05,37.42-20.24,37.42Z"/>
      <path fill="white" d="M148.57,215.96c5.96,0,8.62-5.52,9.99-11.29,1.36-5.77,6.36-22.46,6.36-22.46,0,0,7.1,20.48,24.42,34.44,17.31,13.96,31.33,9.74,36.3,4.9,4.44-4.33,4.66-8.07,3.14-10.98-.18-.34-.37-.67-.59-.99-2.11-3.04-7.69-.12-16.13-2.05-8.44-1.92-18.61-10.18-26.68-24.26-8.07-14.08-7.32-13.87-7.32-13.87,0,0,10.92-3.51,17.13-12.94,3.78-5.75,4.49-10.29,3.28-13.67-.78-2.17-2.34-3.86-4.4-5.07-5.27-3.1-9.36,1.28-11.51,6.61-1.33,3.29-6.03,8.25-11.4,12.22.2-.76,10.53-39.61,13.72-52.21,2.12-8.37,2.04-14.29-1.37-17.95-1.77-1.9-4.45-3.19-8.18-3.89-10.92-2.05-24.51,9.37-31.83,17.25s-13.96,14.02-13.96,27.92c0,.35,0,.69.02,1.02.41,12.91,8.62,13.56,11.65,13.56s9.74-1.92,9.74-10.42c0-1.43-.22-2.65-.51-3.63-.53-1.82-1.29-2.82-1.29-2.82,0,0,3.6-12.22,16.82-17.25-.04.16-.08.32-.12.49-9.17,37.37-21.17,88.27-23.02,95.07-.26.94-.44,1.85-.56,2.72-.76,5.5,1.19,9.56,6.33,9.56Z"/>
      <path fill="white" d="M256.83,171.53c6.79,0,9.12-5.17,10.8-16.01s8-27.69,15.4-35.27c-.51,9.21,7.91,10.84,12.66,5.72,4.75-5.12,6.33-14.43,3.16-20.76-.43-.85-.95-1.59-1.55-2.22-3.84-4.02-10.77-3.4-15.2,1.8-1.93,2-3.81,4.5-4.35,5.23-.1.13-.16.22-.16.22,0,0-.17-1.09-.89-2.27-.84-1.39-2.43-2.89-5.39-2.89-5.49,0-7.86,3.91-12.29,23.97-2.94,13.34-5.86,22.44-7.42,28.9-.78,3.25-1.22,5.84-1.15,7.95.23,6.33,6.38,5.63,6.38,5.63Z"/>
      <path fill="white" d="M316.49,154.97c7.54-4.05,9.03-9.73,7.91-14.01-.16-.63-.4-1.15-.69-1.59-1.67-2.6-5.06-2.16-5.73,1.22-.79,3.96-4.93,3.58-4.93,3.58,0,0,10.5-38.94,10.5-43.03,0-3.11-.47-6.8-3.74-8.39-1.03-.5-2.33-.79-3.99-.79-2.95,0-6.08,1.26-7.38,6.93-1.3,5.68-6.24,26.11-7.94,33.27-.72,3.03-1.51,6.25-1.93,9.3-.57,4.15-.44,7.97,1.49,10.57,3.35,4.51,8.89,6.98,16.43,2.93Z"/>
      <path fill="white" d="M329.1,77.39c0-1.09-.2-2.12-.55-3.08-1.22-3.36-4.36-5.76-8.06-5.76s-6.96,2.49-8.13,5.94c-.31.91-.48,1.88-.48,2.9,0,4.88,3.85,8.84,8.61,8.84s8.61-3.96,8.61-8.84Z"/>
      <path fill="white" d="M327.06,125.3c-.56,2.95-.84,5.43-.84,8.03,0,7.07,3.82,16.61,15.17,16.61s14.43-10.66,14.43-13.68c0-.97-.36-1.95-.94-2.74-1.24-1.66-3.5-2.43-5.62-.38-2.62,2.54-4.94,2.78-7.52,2.41-.49-.07-.99-.16-1.51-.27l15.5-60.12s1.58-.7,12.66-4.37c11.77-3.72,16.29-6.28,16.29-10.05,0-2.41-1.58-4.2-4.29-4.74-1.53-.3-3.41-.21-5.58.41-6,1.72-15.87,5.09-15.87,5.09,0,0,0,0,0-.03,0-.28,0-3,2.51-10.55,2.65-8,14.85-15.87,14.85-32.11,0-10.9-4.59-16.53-9.24-18.23-1.05-.38-2.09-.57-3.09-.57-1.58,0-6.65.37-8.52,8.05-1.86,7.68-18.71,77.58-22.94,94.79-2.68,10.89-4.48,17.37-5.45,22.45Z"/>
      <path fill="white" d="M421.56,119.13c-1.4-6.18-4.19-11.12-7.67-13.21-.13-.08-.26-.14-.39-.2-2.89-1.41-5.2,1.25-3.15,3.74,1.52,1.85,6.25,9.11,3.33,19.21-1.2,4.16-3.7,8.8-8.26,13.74-15.64,16.94-37.51,13.03-67.11,16.38-29.6,3.35-60.5,8.93-101.73,24.85-16.1,5.86-30.71,12.01-30.71,12.01,0,0,3.27,3.17,10.46,2.97.78-.02,1.6-.07,2.47-.18,8.93-1.12,12.94,1.77,15.26,4.84,44.4-16.57,73.34-25.04,128.35-27.18,37.14-2.05,46.26-13.59,55.19-29.04,5.14-8.9,5.84-19.54,3.95-27.92Z"/>
    </svg>
  );

  // Componente del ícono de WhatsApp
  const WhatsAppIcon = () => (
    <svg 
      className="w-7 h-7 text-white" 
      fill="currentColor" 
      viewBox="0 0 24 24"
    >
      <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.465 3.488"/>
    </svg>
  );

  return (
    <div className="fixed bottom-6 right-6 z-50">
      {/* Ventana de Chat */}
      {(isOpen || isClosing) && (
        <div className={`absolute bottom-20 right-0 w-80 bg-white rounded-2xl shadow-2xl overflow-hidden ${
          isClosing ? 'animate-slide-down' : 'animate-slide-up'
        }`}>
          {/* Header */}
          <div className="bg-white px-4 py-4 flex items-center justify-between border-b border-gray-100">
            <div className="flex items-center space-x-3">
              <div className="w-10 h-10 bg-orange-400 rounded-full flex items-center justify-center p-1">
                <KokoritoLogo />
              </div>
              <div>
                <h3 className="font-semibold text-gray-900 text-sm">Kokorito Repostería</h3>
                <p className="text-xs text-gray-500">Envía tu mensaje directo a WhatsApp</p>
              </div>
            </div>
            <button
              onClick={handleClose}
              className="p-1 hover:bg-gray-100 rounded-full transition-colors"
            >
              <X className="w-5 h-5 text-gray-500" />
            </button>
          </div>

          {/* Mensaje de bienvenida */}
          <div className="p-4 bg-gray-50">
            <div className="bg-white text-gray-800 rounded-2xl rounded-bl-md shadow-sm border border-gray-100 px-4 py-3 mb-4">
              <p className="text-sm leading-relaxed">¡Hola! Bienvenido a Kokorito Repostería</p>
              <p className="text-sm leading-relaxed">¿Cómo podemos ayudarte?</p>
              <p className="text-xs text-gray-400 mt-2">
                {new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
              </p>
            </div>
          </div>

          {/* Área de Input */}
          <div className="p-4 bg-white">
            <div className="flex items-center space-x-2 mb-3">
              <input
                type="text"
                value={message}
                onChange={(e) => setMessage(e.target.value)}
                onKeyPress={handleKeyPress}
                placeholder="Escribe tu mensaje aquí..."
                className="flex-1 px-4 py-2 border border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm bg-gray-50"
              />
              <button
                onClick={handleSendToWhatsApp}
                className="p-2 bg-green-500 hover:bg-green-600 rounded-full transition-colors"
              >
                <Send className="w-4 h-4 text-white" />
              </button>
            </div>
            
            {/* Botón Enviar a WhatsApp */}
            <button
              onClick={handleSendToWhatsApp}
              className="w-full bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-full font-medium transition-colors text-sm flex items-center justify-center space-x-2"
            >
              <WhatsAppIcon />
              <span>Enviar a WhatsApp</span>
            </button>
            
            {/* Texto de powered by */}
            <p className="text-xs text-gray-400 text-center mt-2">Powered by Kokorito Repostería</p>
          </div>
        </div>
      )}

      {/* Botón de WhatsApp */}
      <button
        onClick={isOpen ? handleClose : handleOpen}
        className={`w-14 h-14 bg-green-500 hover:bg-green-600 rounded-full shadow-lg flex items-center justify-center transition-all duration-300 ${
          isOpen ? 'rotate-90' : 'animate-bounce-in hover:scale-110'
        }`}
      >
        {isOpen ? (
          <X className="w-6 h-6 text-white" />
        ) : (
          <WhatsAppIcon />
        )}
      </button>

      {/* Badge de notificación */}
      {!isOpen && (
        <div className="absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center animate-pulse">
          <span className="text-xs text-white font-bold">1</span>
        </div>
      )}
    </div>
  );
};

export default WhatsAppToggle; 